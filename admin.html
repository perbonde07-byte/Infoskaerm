<!doctype html>
<html lang="da">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin • Infoscreen</title>
<style>
  /* ===========================
     PB-DESIGN • ENKEL ADMIN UI
     =========================== */
  :root{
    --bg:#0d4952; --panel:#0c2d33; --ink:#e9fbff; --dim:#a8d7de;
    --ok:#1f9d68; --bad:#c23b3b; --btn:#173c43; --line:#0a2328;
    --radius:14px; --radius-sm:10px; --accent:#a7d0c9;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.45 ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}

  /* topbar */
  header{position:sticky;top:0;z-index:5;background:rgba(12,45,51,.95);backdrop-filter:saturate(140%) blur(4px);
    border-bottom:1px solid var(--line)}
  .bar{max-width:1200px;margin:0 auto;padding:10px 14px;display:flex;align-items:center;gap:10px}
  .brand{font-weight:800;font-size:20px;margin-right:auto}

  /* buttons */
  .btn{background:var(--btn);border:1px solid var(--line);color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn.ok{background:var(--ok)}
  .btn.bad{background:var(--bad)}
  .chip{padding:6px 10px;border-radius:12px;border:1px solid var(--line);background:#0b3137}

  /* layout */
  .wrap{max-width:1200px;margin:14px auto 120px;padding:0 14px}
  .panel{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:16px}
  .panel h2{margin:0 0 8px}

  /* tabs */
  .tabs{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
  .tab{background:#0b3137;border:1px solid var(--line);padding:8px 12px;border-radius:10px;cursor:pointer}
  .tab.active{background:#134a52}
  .tabview{display:none}
  .tabview.active{display:block}

  /* forms */
  label{display:block;font-size:13px;color:var(--dim);margin:10px 0 6px}
  input,textarea,select{width:100%;border-radius:10px;border:1px solid #18424a;background:#0a2328;color:var(--ink);padding:10px 12px}
  textarea{min-height:90px;resize:vertical}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .row>*{flex:1}
  .hint{font-size:12px;color:var(--accent)}
  .grid2{display:grid;grid-template-columns:1fr 380px;gap:14px}
  @media (max-width:1000px){.grid2{grid-template-columns:1fr}}

  /* slides */
  .slides{display:flex;flex-direction:column;gap:10px}
  .slide-card{border:1px solid var(--line);border-radius:12px;background:#092b30;padding:12px}
  .slide-head{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .slide-title{font-weight:700}
  .small{font-size:12px;color:#9abec4}

  /* footer bar */
  .footer{position:fixed;left:0;right:0;bottom:0;background:#0c2d33;border-top:1px solid var(--line)}
  .footer .bar{justify-content:flex-end}

  /* modal */
  .modal{position:fixed;inset:0;background:#0007;display:none;align-items:center;justify-content:center;padding:24px;z-index:10}
  .modal.open{display:flex}
  .sheet{max-width:1100px;width:100%;background:#092b30;border:1px solid var(--line);border-radius:14px;padding:16px}
  .sheet .bar{padding:0}
  .list table{width:100%;border-collapse:collapse}
  .list th,.list td{border-bottom:1px solid var(--line);padding:10px 12px;text-align:left}
  .list th{background:#0b2a30;color:#a6c6cb;font-weight:700;letter-spacing:.06em;font-size:12px}
  .thumb{width:56px;height:56px;border-radius:10px;object-fit:cover;border:1px solid var(--line);background:#062026}

  /* diag */
  details.diag{margin-bottom:12px}
  details.diag summary{cursor:pointer;color:#b7e7ee}
</style>
</head>
<body>

<!-- Topbar -->
<header>
  <div class="bar">
    <div class="brand">Admin • Infoscreen</div>

    <!-- Hurtig-tilføj slide -->
    <button class="btn chip" id="addImage">+ Billede</button>
    <button class="btn chip" id="addText">+ Tekst</button>
    <button class="btn chip" id="addEmpties">+ Tømning</button>
    <button class="btn chip" id="addBirth">+ Fødselsdage</button>

    <!-- Filer -->
    <button class="btn" id="openFiles">Filer (medarb & media)</button>
  </div>
</header>

<div class="wrap">
  <!-- Diagnose (kan foldes sammen) -->
  <details class="diag">
    <summary>Diagnose</summary>
    <div class="panel" id="diagBox">Indlæser…</div>
  </details>

  <!-- Tabs -->
  <div class="tabs" id="tabs">
    <div class="tab active" data-tab="brand">Brand & Tema</div>
    <div class="tab" data-tab="tomning">Tømning</div>
    <div class="tab" data-tab="fodselsdage">Fødselsdage</div>
    <div class="tab" data-tab="kalender">Kalender</div>
    <div class="tab" data-tab="slides">Slides</div>
  </div>

  <div class="grid2">
    <!-- Venstre side: faner/indhold -->
    <div>
      <!-- Brand -->
      <section class="panel tabview active" id="tab-brand">
        <h2>Brand</h2>
        <label>Brand</label>
        <input id="brand" type="text" placeholder="Bredsgaard • Infoskærm">
        <label>Logo URL</label>
        <div class="row">
          <input id="logoUrl" type="text" placeholder="/media/Bredsgaard-logo transparnt.png">
          <button class="btn" data-pick="#logoUrl">Vælg fra filer</button>
        </div>

        <div style="height:1px;background:var(--line);margin:16px -16px"></div>
        <h2>Tema</h2>
        <div class="row">
          <div><label>Baggrund 1</label><input id="bg1" type="text" placeholder="#0d4952"></div>
          <div><label>Baggrund 2</label><input id="bg2" type="text" placeholder="#0b6a74"></div>
          <div><label>Accent</label><input id="accent" type="text" placeholder="#a7d0c9"></div>
        </div>
        <label>Opdaterings-interval (ms)</label>
        <input id="refreshMs" type="number" min="60000" step="1000" value="300000">
      </section>

      <!-- Tømning -->
      <section class="panel tabview" id="tab-tomning">
        <h2>Tømning (automatisk plan)</h2>
        <div class="row">
          <div><label>Startdato</label><input id="emptiesStart" type="date"></div>
          <div><label>Horizon (antal kommende linjer)</label><input id="emptiesHorizon" type="number" min="2" max="20" value="8"></div>
        </div>

        <label>Ugedage</label>
        <div class="row" id="wdWrap" style="gap:12px">
          <label class="btn" style="flex:0 0 auto"><input type="checkbox" class="wd" value="1"> MAN</label>
          <label class="btn" style="flex:0 0 auto"><input type="checkbox" class="wd" value="2"> TIR</label>
          <label class="btn" style="flex:0 0 auto"><input type="checkbox" class="wd" value="3"> ONS</label>
          <label class="btn" style="flex:0 0 auto"><input type="checkbox" class="wd" value="4"> TOR</label>
          <label class="btn" style="flex:0 0 auto"><input type="checkbox" class="wd" value="5"> FRE</label>
        </div>

        <label>Navne (rækkefølge — en pr. linje)</label>
        <textarea id="emptiesNames" placeholder="Per&#10;Louise&#10;Max"></textarea>

        <label>Ekskluder datoer (en pr. linje — dd.mm.yyyy)</label>
        <textarea id="emptiesSkip" placeholder="25.12.2025&#10;01.01.2026"></textarea>

        <div class="row">
          <div>
            <label>Antal kolonner i visning</label>
            <select id="emptiesCols">
              <option value="1">1 kolonne</option>
              <option value="2" selected>2 kolonner</option>
            </select>
          </div>
          <div class="hint" style="align-self:flex-end">Tip: “Tømning”-sliden bruger altid denne opsætning.</div>
        </div>
      </section>

      <!-- Fødselsdage -->
      <section class="panel tabview" id="tab-fodselsdage">
        <h2>Fødselsdage</h2>
        <label>Standard-besked (bruges i alarm-slides)</label>
        <input id="bdayMsg" type="text" placeholder="Tillykke med fødselsdagen - Håber du har dig en god uge.">
        <div id="bdayList"></div>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="addBday">+ Tilføj person</button>
        </div>
        <div class="hint">Dato kan være <b>dd.mm</b> eller <b>dd.mm.yyyy</b>. Visning viser fødselsdato og alder (PB-DESIGN).</div>
      </section>

      <!-- Kalender -->
      <section class="panel tabview" id="tab-kalender">
        <h2>Kalender (ICS)</h2>
        <label>Kalender ICS-URL</label>
        <input id="calUrl" type="text" placeholder="https://.../calendar.ics">
        <div class="row">
          <div><label>Dage frem (visning)</label><input id="calDays" type="number" min="1" max="365" value="60"></div>
          <div><label>Maks. antal events</label><input id="calMax" type="number" min="1" max="500" value="50"></div>
        </div>
        <div class="row">
          <div>
            <label>Vis klokkeslæt</label>
            <select id="calTime"><option value="1">Ja</option><option value="0">Nej</option></select>
          </div>
          <div>
            <label>Visningsstil</label>
            <select id="calStyle">
              <option value="list">Punktliste</option>
              <option value="cards">Bokse</option>
            </select>
          </div>
        </div>
        <div class="hint">Vises på <code>/kalender.html</code>. Hvis ICS-URL er tom, vises kommende fødselsdage i stedet.</div>
      </section>
    </div>

    <!-- Højre side: slides -->
    <section class="panel tabview" id="tab-slides">
      <h2>Slides (rækkefølge)</h2>
      <div class="slides" id="slides"></div>
      <div class="small" style="margin-top:8px">Brug “Op/Ned” for rækkefølge. “Tømning”/“Fødselsdage” trækker data fra venstrepanelet.</div>
    </section>
  </div>
</div>

<!-- Footer save -->
<div class="footer">
  <div class="bar">
    <input id="adminPin" class="chip" type="password" placeholder="PIN (ADMIN_PIN)" style="max-width:200px">
    <button class="btn ok" id="saveBtn">Gem ændringer</button>
  </div>
</div>

<!-- Modal: filer -->
<div class="modal" id="fileModal" aria-hidden="true">
  <div class="sheet">
    <div class="bar">
      <div class="brand" style="font-size:18px">Filer</div>
      <div>
        <button class="btn" data-tab="medarbejdere">/medarbejdere</button>
        <button class="btn" data-tab="media">/media</button>
        <button class="btn bad" id="closeFiles">Luk</button>
      </div>
    </div>
    <div class="row">
      <input id="upName" type="text" placeholder="navn.jpg" style="flex:0 0 220px">
      <input id="upFile" type="file" accept="image/*" style="flex:1">
      <button class="btn ok" id="btnUpload" style="flex:0 0 130px">Upload</button>
      <span id="upHint" class="hint"></span>
    </div>
    <div class="list" style="margin-top:10px">
      <table id="fileTable">
        <thead>
          <tr><th></th><th>Navn</th><th>Sti</th><th>Brug</th><th>Omdøb</th><th>Slet</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    <div id="opStatus" class="hint" style="margin-top:8px"></div>
  </div>
</div>

<script>
/* ===================================
   PB-DESIGN • Helper & data-håndtering
   =================================== */
const $  = (q, el=document) => el.querySelector(q);
const $$ = (q, el=document) => Array.from(el.querySelectorAll(q));

let DATA=null, ACTIVE_DIR="medarbejdere", FILE_TARGET=null;

async function api(action, payload){
  const r = await fetch("/api/data", { method:"POST", headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ action, ...(payload||{}) }) });
  const j = await r.json();
  if(!j.ok) throw new Error(j.error||"Fejl");
  return j;
}
async function loadData(){
  const j = await (await fetch("/api/data")).json();
  if(!j.ok) throw new Error(j.error||"Fejl");
  return j.content;
}
function toLines(el){ return (el.value||"").split(/\r?\n/).map(s=>s.trim()).filter(Boolean) }
function fromLines(arr){ return (arr||[]).join("\n") }

/* =========================
   PB-DESIGN • Tabs (enkelt)
   ========================= */
$("#tabs").addEventListener("click", (e)=>{
  const t = e.target.closest(".tab"); if(!t) return;
  $$(".tab").forEach(x=>x.classList.remove("active"));
  t.classList.add("active");
  const id = t.dataset.tab;
  $$(".tabview").forEach(x=>x.classList.remove("active"));
  $("#tab-"+id).classList.add("active");
});

/* =================================
   PB-DESIGN • Fødselsdage (UI del)
   ================================= */
function renderBdays(b){
  const host=$("#bdayList"); host.innerHTML="";
  (b||[]).forEach((p,i)=>{
    const id="img_"+i;
    const row=document.createElement("div"); row.className="row"; row.style.marginTop="8px";
    row.innerHTML = `
      <input type="text" placeholder="Navn" value="${p.name||""}" data-k="name">
      <input type="text" placeholder="dd.mm eller dd.mm.yyyy" value="${p.date||""}" data-k="date" style="max-width:220px">
      <input id="${id}" type="text" placeholder="/medarbejdere/Per.jpg" value="${p.image||""}" data-k="image">
      <button class="btn" data-pick="#${id}">Vælg fra filer</button>
      <button class="btn bad" data-del>Fjern</button>
    `;
    row.addEventListener("input", e=>{const k=e.target.dataset.k; if(k) p[k]=e.target.value.trim();});
    $("[data-del]",row).onclick=()=>{ b.splice(i,1); renderBdays(b); };
    $("[data-pick]",row).onclick=(ev)=>{ openFileModal("medarbejdere", ev.currentTarget.getAttribute("data-pick")); };
    host.appendChild(row);
  });
  $("#addBday").onclick=()=>{ b.push({name:"",date:"",image:""}); renderBdays(b); };
}

/* ============================
   PB-DESIGN • Slides (UI del)
   ============================ */
function slideTitle(s){
  if(s.type==="image") return s.title||"Billede";
  if(s.type==="text")  return s.title||"Tekst";
  if(s.type==="empties") return s.title||"Tømning";
  if(s.type==="birthday") return s.title||"Fødselsdage";
  return s.type||"Slide";
}
function findInputSelector(scope, key){
  const inp = scope.querySelector(`[data-k="${key}"]`);
  if(!inp.id) inp.id = `f_${key}_${Math.random().toString(36).slice(2,7)}`;
  return `#${inp.id}`;
}
function renderSlides(){
  const box=$("#slides"); box.innerHTML="";
  (DATA.slides||[]).forEach((s,idx)=>{
    const card=document.createElement("div"); card.className="slide-card";
    card.innerHTML = `
      <div class="slide-head">
        <div class="slide-title">${slideTitle(s)} <span class="small">(${s.type})</span></div>
        <div class="row" style="flex:0 0 auto">
          <button class="btn" data-up>Op</button>
          <button class="btn" data-down>Ned</button>
          <button class="btn bad" data-del>Fjern</button>
        </div>
      </div>
      <div class="slide-body">
        <div class="row">
          <div><label>Titel</label><input data-k="title" value="${s.title||""}"></div>
          <div style="flex:0 0 140px"><label>Varighed (sek.)</label><input type="number" min="3" max="120" data-k="duration" value="${s.duration??12}"></div>
        </div>
        ${s.type==="image" ? `
          <div class="row">
            <input data-k="image" placeholder="/media/billede.jpg" value="${s.image||""}">
            <button class="btn" data-pick="image">Vælg fra filer</button>
          </div>
          <div class="row">
            <textarea data-k="sideText" placeholder="Valgfri tekst ved siden af billedet (så rykkes billedet til den ene side)">${s.sideText||""}</textarea>
          </div>
        `: s.type==="text" ? `
          <div class="row"><textarea data-k="content" placeholder="Tekstindhold">${s.content||""}</textarea></div>
        `: s.type==="empties" ? `
          <div class="small">Bruger “Tømning (automatisk plan)” fra fanen “Tømning”.</div>
        `: s.type==="birthday" ? `
          <div class="small">Bruger personer fra fanen “Fødselsdage”.</div>
        `: ``}
      </div>
    `;
    // events
    card.addEventListener("input",(e)=>{
      const k=e.target.dataset.k; if(!k) return;
      let v=e.target.value;
      if(k==="duration") v=Number(v||12);
      s[k]=v;
    });
    $("[data-up]",card).onclick=()=>{ if(idx>0){ const t=DATA.slides[idx-1]; DATA.slides[idx-1]=DATA.slides[idx]; DATA.slides[idx]=t; renderSlides(); } };
    $("[data-down]",card).onclick=()=>{ if(idx<DATA.slides.length-1){ const t=DATA.slides[idx+1]; DATA.slides[idx+1]=DATA.slides[idx]; DATA.slides[idx]=t; renderSlides(); } };
    $("[data-del]",card).onclick=()=>{ DATA.slides.splice(idx,1); renderSlides(); };
    $("[data-pick]",card)?.addEventListener("click",()=>openFileModal("media", findInputSelector(card,"image")));
    box.appendChild(card);
  });
}

/* ============================
   PB-DESIGN • Init + Save
   ============================ */
(async function init(){
  // diagnose
  $("#diagBox").innerHTML = [
    "REPO_BASE = \"\" (Vercel/egen host)",
    "data.json indlæses…"
  ].map(x=>`<div>• ${x}</div>`).join("");

  DATA = await loadData();
  $("#diagBox").innerHTML += `<div>• data.json indlæst</div>`;

  // defaults
  DATA.brand   ??= "";
  DATA.logoUrl ??= "";
  DATA.theme   ??= { bg1:"#0d4952", bg2:"#0b6a74", accent:"#a7d0c9" };
  DATA.settings??= { refreshMs:300000 };
  DATA.empties ??= { startDate:"", horizon:8, weekdays:[1], names:[], skipDates:[], columns:2 };
  DATA.birthdays ??= { message:"", people:[] };
  DATA.calendar  ??= { url:"", daysAhead:60, maxEvents:50, showTime:true, style:"list" };
  DATA.slides    ??= [];

  // brand/tema
  $("#brand").value  = DATA.brand;
  $("#logoUrl").value= DATA.logoUrl;
  $("#bg1").value    = DATA.theme.bg1;
  $("#bg2").value    = DATA.theme.bg2;
  $("#accent").value = DATA.theme.accent;
  $("#refreshMs").value = DATA.settings.refreshMs;

  // tømning
  $("#emptiesStart").value   = DATA.empties.startDate||"";
  $("#emptiesHorizon").value = DATA.empties.horizon||8;
  const wd = (DATA.empties.weekdays||[]);
  $$(".wd").forEach(cb=>{ cb.checked = wd.includes(Number(cb.value)); });
  $("#emptiesNames").value = fromLines(DATA.empties.names||[]);
  $("#emptiesSkip").value  = fromLines(DATA.empties.skipDates||[]);
  $("#emptiesCols").value  = String(DATA.empties.columns||2);

  // fødselsdage
  $("#bdayMsg").value = DATA.birthdays.message||"";
  renderBdays(DATA.birthdays.people||[]);

  // kalender
  $("#calUrl").value  = DATA.calendar.url||"";
  $("#calDays").value = DATA.calendar.daysAhead||60;
  $("#calMax").value  = DATA.calendar.maxEvents||50;
  $("#calTime").value = DATA.calendar.showTime ? "1":"0";
  $("#calStyle").value= DATA.calendar.style||"list";

  // slides
  renderSlides();

  // topbar add
  $("#addImage").onclick   = ()=>{ DATA.slides.push({type:"image", title:"Kampagne", image:"", sideText:"", duration:12}); renderSlides(); };
  $("#addText").onclick    = ()=>{ DATA.slides.push({type:"text", title:"Tekst", content:"", duration:12}); renderSlides(); };
  $("#addEmpties").onclick = ()=>{ DATA.slides.push({type:"empties", title:"TØMNINGS DAGE", duration:12}); renderSlides(); };
  $("#addBirth").onclick   = ()=>{ DATA.slides.push({type:"birthday", title:"FØDSELSDAGE", duration:12}); renderSlides(); };

  // save + filer
  $("#saveBtn").onclick = onSave;
  $("#openFiles").onclick = ()=>openFileModal("medarbejdere");
  $$("[data-pick]").forEach(b=>b.addEventListener("click",(ev)=>openFileModal("media", ev.currentTarget.getAttribute("data-pick"))));
  $("#closeFiles").onclick = closeFileModal;
  $$(".sheet [data-tab]").forEach(b=> b.onclick = ()=>{ ACTIVE_DIR=b.getAttribute("data-tab"); refreshDir(); });

  $("#diagBox").innerHTML += [
    `<div>• Indlæst: brand/tema</div>`,
    `<div>• Indlæst: tømning</div>`,
    `<div>• Indlæst: fødselsdage</div>`,
    `<div>• Indlæst: kalender</div>`,
    `<div>• Indlæst: slides</div>`
  ].join("");
})().catch(e=>alert(e.message||e));

async function onSave(){
  // brand/tema
  DATA.brand = $("#brand").value.trim();
  DATA.logoUrl = $("#logoUrl").value.trim();
  DATA.theme = { bg1: $("#bg1").value.trim(), bg2: $("#bg2").value.trim(), accent: $("#accent").value.trim() };
  DATA.settings = { refreshMs: Number($("#refreshMs").value||300000) };

  // tømning
  DATA.empties = {
    startDate: $("#emptiesStart").value,
    horizon: Number($("#emptiesHorizon").value||8),
    weekdays: $$(".wd").filter(cb=>cb.checked).map(cb=>Number(cb.value)),
    names: toLines($("#emptiesNames")),
    skipDates: toLines($("#emptiesSkip")),
    columns: Number($("#emptiesCols").value||2)
  };

  // fødselsdage
  const people=[];
  $$("#bdayList .row").forEach(r=>{
    people.push({
      name:$("[data-k=name]",r).value.trim(),
      date:$("[data-k=date]",r).value.trim(),
      image:$("[data-k=image]",r).value.trim()
    });
  });
  DATA.birthdays = { message: $("#bdayMsg").value.trim(), people: people.filter(p=>p.name) };

  // kalender
  DATA.calendar = {
    url: $("#calUrl").value.trim(),
    daysAhead: Number($("#calDays").value||60),
    maxEvents: Number($("#calMax").value||50),
    showTime: $("#calTime").value==="1",
    style: $("#calStyle").value
  };

  const pin=$("#adminPin").value.trim(); if(!pin){ alert("Indtast PIN (ADMIN_PIN) før gem."); return;}
  await api("saveDataJson", { data: DATA, message:`PB-DESIGN: admin gem` });
  alert("Gemt ✔");
}

/* ==========================
   PB-DESIGN • Filhåndtering
   ========================== */
function openFileModal(dir="medarbejdere", targetInput=null){
  ACTIVE_DIR=dir; FILE_TARGET=targetInput; $("#fileModal").classList.add("open"); refreshDir();
}
function closeFileModal(){ $("#fileModal").classList.remove("open"); FILE_TARGET=null; }

async function refreshDir(){
  $("#opStatus").textContent="Henter…";
  const { items } = await api("listDir", { path: ACTIVE_DIR });
  const tb=$("#fileTable tbody"); tb.innerHTML="";
  (items||[]).filter(x=>x.type==="file").sort((a,b)=>a.name.localeCompare(b.name,"da",{numeric:true}))
  .forEach(it=>{
    const tr=document.createElement("tr");
    tr.innerHTML = `
      <td><img class="thumb" src="${it.raw}"></td>
      <td>${it.name}</td>
      <td>/${it.path}</td>
      <td><button class="btn" data-use>Brug</button></td>
      <td><button class="btn" data-rename>Omdøb</button></td>
      <td><button class="btn bad" data-del>Slet</button></td>
    `;
    $("[data-use]",tr).onclick=()=>{ if(FILE_TARGET){ const el=document.querySelector(FILE_TARGET); if(el) el.value=`/${it.path}`; closeFileModal(); } };
    $("[data-rename]",tr).onclick=async()=>{
      const nn=prompt("Nyt navn (inkl. .jpg/.png):", it.name); if(!nn) return;
      await api("renamePath", { oldPath: it.path, newPath: `${ACTIVE_DIR}/${nn}`, message:`PB-DESIGN: rename ${it.path}` });
      refreshDir();
    };
    $("[data-del]",tr).onclick=async()=>{ if(!confirm(`Slet /${it.path}?`))return; await api("deletePath",{ path: it.path, message:`PB-DESIGN: delete ${it.path}` }); refreshDir(); };
    tb.appendChild(tr);
  });
  $("#opStatus").textContent=`/${ACTIVE_DIR}: ${items?.length||0} filer`;
}
$("#btnUpload").onclick = async ()=>{
  const f=$("#upFile").files[0]; const name=($("#upName").value||"").trim();
  if(!f||!name){ $("#upHint").textContent="Vælg fil + navn"; return; }
  const b64=await new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(String(r.result||"")); r.onerror=rej; r.readAsDataURL(f); });
  $("#upHint").textContent="Uploader…";
  await api("uploadBase64", { path:`${ACTIVE_DIR}/${name}`, base64:b64, message:`PB-DESIGN: upload ${ACTIVE_DIR}/${name}` });
  $("#upHint").textContent="Uploadet ✔"; $("#upFile").value=""; $("#upName").value=""; refreshDir();
};

/* ==========================
   PB-DESIGN • Hurtig hjælp
   ========================== */
// Kort forklaring til editoren (kan fjernes):
console.log("PB-DESIGN: Admin UI indlæst.");
</script>
</body>
</html>
