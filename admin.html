<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin – Infoskærm</title>
  <style>
    body{margin:0;background:#0b1220;color:#e8eefb;font-family:system-ui,Segoe UI,Roboto,Arial}
    header{display:flex;gap:16px;align-items:center;padding:18px 22px;border-bottom:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg,rgba(255,255,255,.04),transparent)}
    h1{font-size:18px;margin:0}
    main{max-width:1000px;margin:24px auto;padding:0 16px;display:grid;gap:22px}
    .card{background:#111a2d;border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:16px}
    .row{display:grid;grid-template-columns:160px 1fr;gap:10px;align-items:center;margin:8px 0}
    input,textarea,select{width:100%;padding:10px;border-radius:10px;background:#0e172a;color:#e8eefb;border:1px solid rgba(255,255,255,.15)}
    textarea{min-height:72px}
    button{padding:10px 14px;border-radius:10px;border:0;background:#5aa2ff;color:#081325;font-weight:700;cursor:pointer}
    .ghost{background:#24324f;color:#e8eefb}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;font-size:14px}
    .hint{opacity:.7;font-size:12px}
    .ok{color:#9fe29f}
    .err{color:#ff9c9c}
  </style>
</head>
<body>
  <header>
    <h1>Admin • Infoskærm</h1>
    <div style="margin-left:auto" id="status" class="hint">Indlæser data…</div>
  </header>
  <main>
    <section class="card">
      <h2 style="margin:0 0 6px;font-size:16px">Datakilde</h2>
      <div class="hint">Denne admin-side læser <code>data.json</code> fra dit repo og lader dig downloade en opdateret fil, som du derefter uploader i GitHub.</div>
      <div class="row"><label>Adresse til data.json</label>
        <input id="dataUrl" placeholder="https://perbonde07-byte.github.io/Infoskaerm/data.json">
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
<button id="save_btn" style="margin-left:8px;">Gem til server</button>

      </div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 6px;font-size:16px">Slides</h2>
      <div class="row"><label>Type</label>
        <select id="s_type"><option>bullets</option><option>image</option></select>
      </div>
      <div class="row"><label>Titel</label><input id="s_title"></div>
      <div class="row"><label>Linjer</label><textarea id="s_lines" placeholder="Punkt 1 | Punkt 2 | Punkt 3"></textarea></div>
      <div class="row"><label>Billede (URL)</label><input id="s_image" placeholder="https://... (kun til type=image)"></div>
      <div class="row"><label>Varighed (sek.)</label><input id="s_duration" type="number" value="12" min="3"></div>
      <div style="display:flex;gap:8px"><button id="addSlide">Tilføj slide</button><button class="ghost" id="clearSlides">Tøm alle slides</button></div>
      <div style="margin-top:12px;overflow:auto">
        <table id="slidesTable"><thead><tr><th>#</th><th>Type</th><th>Titel</th><th>Forhåndsvisning</th><th></th></tr></thead><tbody></tbody></table>
      </div>
    </section>

  </main>

  <script>
    const ADMIN_KEY = "0705"; // ← brug din kode her

    (function gate(){
      const p = new URLSearchParams(location.search).get('admin');
      if(p===ADMIN_KEY){ localStorage.setItem('admin_ok','1'); }
      if(localStorage.getItem('admin_ok')!=='1'){
        document.body.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#0b1220;color:#e8eefb;font-family:system-ui">Ingen adgang – åbn med ?admin=0705</div>';
      }
    })();

    const state = {
      dataUrl: 'https://perbonde07-byte.github.io/Infoskaerm/data.json',
      data: { brand:'Bredsgaard Info', slides:[] }
    };

    const $ = (s)=>document.querySelector(s);
    const status = $('#status');

    function render(){
      const tbody = $('#slidesTable tbody'); tbody.innerHTML='';
      state.data.slides.forEach((s,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${i+1}</td><td>${s.type}</td><td>${s.title}</td><td>${s.type==='image'?s.image:(s.lines||[]).join(' | ')}</td>
                      <td><button data-i="${i}" class="ghost del-slide">Slet</button></td>`;
        tbody.appendChild(tr);
      });
      tbody.querySelectorAll('.del-slide').forEach(b=>b.onclick=e=>{
        const i=+e.target.dataset.i; state.data.slides.splice(i,1); render();
      });
      status.textContent='Klar'; status.className='hint ok';
    }

    async function load(){
      try{
        status.textContent='Henter data...';
        const res=await fetch(state.dataUrl+'?v='+Date.now());
        if(res.ok){ state.data=await res.json(); render(); }
        else throw new Error('HTTP '+res.status);
      }catch(e){
        status.textContent='Ingen eksisterende data.json – starter tomt'; state.data={brand:'Bredsgaard Info',slides:[]};
        render();
      }
    }

    $('#loadBtn').onclick=()=>load();
    $('#addSlide').onclick=()=>{
      const s={type:$('#s_type').value,title:$('#s_title').value.trim(),
               lines:($('#s_lines').value||'').split('|').map(x=>x.trim()).filter(Boolean),
               image:$('#s_image').value.trim(),duration:+$('#s_duration').value||12};
      state.data.slides.push(s); render();
    };
    $('#clearSlides').onclick=()=>{if(confirm('Slet alt?')){state.data.slides=[];render();}};
    $('#downloadBtn').onclick=()=>{
      const blob=new Blob([JSON.stringify(state.data,null,2)],{type:'application/json'});
      const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='data.json'; a.click();
    };

    load();
  </script>
</body>
</html>

