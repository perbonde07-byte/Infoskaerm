<div style="padding:18px">
  <h2>Slides (rækkefølge)</h2>
  <div id="slidesBox" style="display:flex;flex-direction:column;gap:10px"></div>
  <small class="small">Brug “Op/Ned” til at sortere. “Tømning”/“Fødselsdage” bruger venstre indstillinger.</small>
</div>

<script>
function slideTitle(s){
  if(s.type==="image") return s.title||"Billede";
  if(s.type==="text")  return s.title||"Tekst";
  if(s.type==="empties") return s.title||"Tømning";
  if(s.type==="birthday") return s.title||"Fødselsdage";
  return s.type||"Slide";
}
function findInputSelector(scope, key){
  const inp = scope.querySelector(`[data-k="${key}"]`);
  if(!inp.id) inp.id = `f_${key}_${Math.random().toString(36).slice(2,7)}`;
  return `#${inp.id}`;
}

function renderSlides(){
  const box = document.getElementById('slidesBox');
  const arr = PB.data.slides ||= [];
  box.innerHTML = '';
  arr.forEach((s,idx)=>{
    const card = document.createElement('div');
    card.className = 'slide-card';
    card.style.cssText = 'border:1px solid #0a2328;border-radius:12px;background:#092b30;padding:12px';

    const head = document.createElement('div');
    head.className='slide-head';
    head.style.cssText='display:flex;align-items:center;justify-content:space-between;gap:10px';
    head.innerHTML = `
      <div><strong>${slideTitle(s)}</strong> <span style="font-size:13px;color:#9fc3c9">(${s.type})</span></div>
      <div style="display:flex;gap:8px">
        <button class="btn" data-up>Op</button>
        <button class="btn" data-down>Ned</button>
        <button class="btn bad" data-del>Fjern</button>
      </div>`;
    card.appendChild(head);

    const body = document.createElement('div');
    body.className='slide-body';
    body.style.cssText='margin-top:8px;display:grid;gap:8px';
    body.innerHTML = `
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <div style="flex:1 1 220px"><label>Titel</label><input data-k="title" value="${s.title||""}"></div>
        <div style="flex:0 0 140px"><label>Varighed (sek.)</label><input type="number" min="3" max="120" data-k="duration" value="${s.duration??12}"></div>
      </div>
      ${s.type==="image" ? `
        <div style="display:flex;gap:10px">
          <input data-k="image" placeholder="/media/billede.jpg" value="${s.image||""}" style="flex:1">
          <button class="btn" data-pick="image">Vælg fra filer</button>
        </div>
        <div><textarea data-k="sideText" placeholder="Valgfri tekst ved siden af billedet">${s.sideText||""}</textarea></div>
      `: s.type==="text" ? `
        <div><textarea data-k="content" placeholder="Tekstindhold">${s.content||""}</textarea></div>
      `: s.type==="empties" ? `
        <div class="small">Bruger Tømning fra venstre panel.</div>
      `: s.type==="birthday" ? `
        <div class="small">Bruger Fødselsdage fra venstre panel.</div>
      `: ``}
    `;
    card.appendChild(body);

    card.addEventListener('input', e=>{
      const k = e.target.dataset.k; if(!k) return;
      s[k] = (k==='duration') ? Number(e.target.value||12) : e.target.value;
    });
    card.querySelector('[data-up]').onclick = ()=>{ if(idx>0){ const t=arr[idx-1]; arr[idx-1]=arr[idx]; arr[idx]=t; renderSlides(); } };
    card.querySelector('[data-down]').onclick = ()=>{ if(idx<arr.length-1){ const t=arr[idx+1]; arr[idx+1]=arr[idx]; arr[idx]=t; renderSlides(); } };
    card.querySelector('[data-del]').onclick = ()=>{ arr.splice(idx,1); renderSlides(); };
    card.querySelector('[data-pick]')?.addEventListener('click',()=> {
      // her kan du senere koble din fil-modal på; nu bare feltfokus
      const sel = findInputSelector(card,'image');
      document.querySelector(sel).focus();
    });

    box.appendChild(card);
  });
}

PB.onReady.push(() => {
  PB.data.slides ||= [];
  renderSlides();

  // koble header-knapper
  const k = {
    addImage(){ PB.data.slides.push({type:"image", title:"Kampagne", image:"", sideText:"", duration:12}); renderSlides(); },
    addText(){ PB.data.slides.push({type:"text", title:"Tekst", content:"", duration:12}); renderSlides(); },
    addEmpties(){ PB.data.slides.push({type:"empties", title:"TØMNINGS DAGE", duration:12}); renderSlides(); },
    addBirth(){ PB.data.slides.push({type:"birthday", title:"FØDSELSDAG", duration:12}); renderSlides(); }
  };
  document.getElementById('addImage')  .onclick = k.addImage;
  document.getElementById('addText')   .onclick = k.addText;
  document.getElementById('addEmpties').onclick = k.addEmpties;
  document.getElementById('addBirth')  .onclick = k.addBirth;
});

// slides gemmes implicit fordi vi allerede har muteret PB.data.slides i UI’et
PB.onSave.push(()=>{ /* no-op */ });
</script>
