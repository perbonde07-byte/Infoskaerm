<section class="panel">
  <h2>Slides (rækkefølge)</h2>
  <div class="slides" id="slidesList"></div>
  <small class="small">Brug “Op/Ned” for rækkefølge. “Tømning”/“Fødselsdage” bruger venstre indstillinger.</small>
</section>

<script>
/* PB-DESIGN: Denne lille blok kører når include er indsat,
   og binder slides-listen til global DATA og eksisterende helpers. */
(function(){
  if(!window.renderSlidesInclude){
    window.renderSlidesInclude = function(){
      const list = document.getElementById("slidesList");
      if(!list || !window.DATA) return;
      list.innerHTML="";
      (DATA.slides||[]).forEach((s,idx)=>{
        const item=document.createElement("div");
        item.className="slide-card";

        function wrapBody(){
          if(s.type==="image"){
            return `<div class="row">
                      <input data-k="image" placeholder="/media/billede.jpg" value="${s.image||""}">
                      <button class="btn" data-pick="image">Vælg fra filer</button>
                    </div>
                    <div class="row">
                      <textarea data-k="sideText" placeholder="Valgfri tekst ved siden af billedet">${s.sideText||""}</textarea>
                    </div>`;
          } else if(s.type==="text"){
            return `<div class="row"><textarea data-k="content" placeholder="Tekstindhold">${s.content||""}</textarea></div>`;
          } else if(s.type==="tomme"){
            return `<div class="small">Bruger “Tømning (automatisk plan)” fra venstre panel.</div>`;
          } else {
            return `<div class="small">Bruger “Fødselsdage” fra venstre panel.</div>`;
          }
        }

        item.innerHTML=`
          <div class="slide-head">
            <div><strong>${(window.slideTitle?sliceTitle=slideTitle:null, slideTitle?slideTitle(s): (s.title||s.type||"Slide"))}</strong> <span class="slide-meta">(${s.type})</span></div>
            <div class="row" style="flex:0 0 auto">
              <button class="btn" data-up>Op</button>
              <button class="btn" data-down>Ned</button>
              <button class="btn bad" data-del>Fjern</button>
            </div>
          </div>
          <div class="slide-body">
            <div class="row">
              <div><label>Titel</label><input data-k="title" value="${s.title||""}"></div>
              <div style="flex:0 0 140px"><label>Varighed (sek.)</label><input type="number" min="3" max="120" data-k="duration" value="${s.duration??12}"></div>
            </div>
            ${wrapBody()}
          </div>
        `;
        item.addEventListener("input",(e)=>{
          const k=e.target.dataset.k; if(!k) return;
          let v=e.target.value; if(k==="duration") v=Number(v||12);
          DATA.slides[idx][k]=v;
        });
        item.querySelector("[data-up]").onclick=()=>{ if(idx>0){ const t=DATA.slides[idx-1]; DATA.slides[idx-1]=DATA.slides[idx]; DATA.slides[idx]=t; renderSlidesInclude(); } };
        item.querySelector("[data-down]").onclick=()=>{ if(idx<DATA.slides.length-1){ const t=DATA.slides[idx+1]; DATA.slides[idx+1]=DATA.slides[idx]; DATA.slides[idx]=t; renderSlidesInclude(); } };
        item.querySelector("[data-del]").onclick=()=>{ DATA.slides.splice(idx,1); renderSlidesInclude(); };
        item.querySelector("[data-pick]")?.addEventListener("click",()=>openFileModal("media", (function(){const inp=item.querySelector('[data-k="image"]'); if(!inp.id) inp.id='img_'+Math.random().toString(36).slice(2,7); return '#'+inp.id;})()));
        list.appendChild(item);
      });
    };
  }
  // Bind top-knapper (findes i header)
  const addImage = document.getElementById("addImage");
  const addText  = document.getElementById("addText");
  const addTom   = document.getElementById("addTomme");
  const addBirth = document.getElementById("addBirth");
  if(addImage) addImage.onclick = ()=>{ DATA.slides.push({type:"image", title:"Kampagne", image:"", sideText:"", duration:12}); renderSlidesInclude(); };
  if(addText)  addText.onclick  = ()=>{ DATA.slides.push({type:"text", title:"Tekst", content:"", duration:12}); renderSlidesInclude(); };
  if(addTom)   addTom.onclick   = ()=>{ DATA.slides.push({type:"tomme", title:"TØMNINGS DAGE", duration:12}); renderSlidesInclude(); };
  if(addBirth) addBirth.onclick = ()=>{ DATA.slides.push({type:"birthday", title:"FØDSELSDAG", duration:12}); renderSlidesInclude(); };

  // første render (hvis DATA allerede er sat)
  if(window.DATA) renderSlidesInclude();
})();
</script>
