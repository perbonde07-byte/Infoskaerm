<div style="padding:18px">
  <h2>Tømning (automatisk plan)</h2>

  <div style="display:flex;gap:10px;flex-wrap:wrap">
    <div style="flex:1 1 180px">
      <label>Startdato</label>
      <input id="emptiesStart" type="date" />
    </div>
    <div style="flex:1 1 180px">
      <label>Horizon (antal kommende linjer)</label>
      <input id="emptiesHorizon" type="number" min="2" max="20" value="8" />
    </div>
  </div>

  <label style="margin-top:10px">Ugedage</label>
  <div id="wdWrap" style="display:flex;gap:12px;flex-wrap:wrap">
    <label class="btn"><input type="checkbox" class="wd" value="1"> MAN</label>
    <label class="btn"><input type="checkbox" class="wd" value="2"> TIR</label>
    <label class="btn"><input type="checkbox" class="wd" value="3"> ONS</label>
    <label class="btn"><input type="checkbox" class="wd" value="4"> TOR</label>
    <label class="btn"><input type="checkbox" class="wd" value="5"> FRE</label>
  </div>

  <label style="margin-top:10px">Navne (rækkefølge — en pr. linje)</label>
  <textarea id="emptiesNames" placeholder="Per&#10;Louise&#10;Max" style="min-height:90px"></textarea>

  <label>Ekskluder datoer (en pr. linje — dd.mm.yyyy)</label>
  <textarea id="emptiesSkip" placeholder="25.12.2025&#10;01.01.2026" style="min-height:80px"></textarea>

  <label>Antal kolonner i visning</label>
  <select id="emptiesCols">
    <option value="1">1 kolonne</option>
    <option value="2">2 kolonner</option>
  </select>
</div>

<script>
function linesToArray(v){return (v||"").split(/\r?\n/).map(s=>s.trim()).filter(Boolean)}
function arrayToLines(a){return (a||[]).join('\n')}

PB.onReady.push(() => {
  const e = PB.data.empties ||= {startDate:"", horizon:8, weekdays:[1], names:[], skipDates:[], columns:2};

  emptiesStart.value   = e.startDate || "";
  emptiesHorizon.value = e.horizon ?? 8;
  document.querySelectorAll('.wd').forEach(cb => {
    cb.checked = (e.weekdays||[]).includes(Number(cb.value));
  });
  emptiesNames.value = arrayToLines(e.names||[]);
  emptiesSkip.value  = arrayToLines(e.skipDates||[]);
  emptiesCols.value  = String(e.columns || 2);
});

PB.onSave.push(() => {
  PB.data.empties = {
    startDate: emptiesStart.value,
    horizon: Number(emptiesHorizon.value || 8),
    weekdays: Array.from(document.querySelectorAll('.wd')).filter(cb=>cb.checked).map(cb=>Number(cb.value)),
    names: linesToArray(emptiesNames.value),
    skipDates: linesToArray(emptiesSkip.value),
    columns: Number(emptiesCols.value || 2)
  };
});
</script>
